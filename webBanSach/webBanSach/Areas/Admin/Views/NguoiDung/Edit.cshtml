@model webBanSach.ViewModels.NguoiDungViewModel

@{
    ViewData["Title"] = "Sửa Người Dùng";
}

<div class="container mt-4">
    <div class="card shadow-lg border-0 rounded-4">
        <!-- Header -->
        <div class="card-header bg-gradient bg-warning text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-pencil-square"></i> Cập nhật thông tin người dùng</h4>
            <a asp-action="Index" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-left"></i> Quay lại
            </a>
        </div>

        <!-- Body -->
        <div class="card-body p-4">
            <form asp-action="Edit" enctype="multipart/form-data" method="post" class="row g-3">
                <input type="hidden" asp-for="MaND" />

                <!-- Họ tên -->
                <div class="col-md-6">
                    <label asp-for="HoTen" class="form-label fw-bold"><i class="bi bi-person"></i> Họ và tên</label>
                    <input asp-for="HoTen" class="form-control" />
                    <span asp-validation-for="HoTen" class="text-danger small"></span>
                </div>

                <!-- Email -->
                <div class="col-md-6">
                    <label asp-for="Email" class="form-label fw-bold"><i class="bi bi-envelope"></i> Email</label>
                    <input asp-for="Email" class="form-control" />
                    <span asp-validation-for="Email" class="text-danger small"></span>
                </div>

                <!-- Mật khẩu -->
                <div class="col-md-6">
                    <label asp-for="MatKhau" class="form-label fw-bold"><i class="bi bi-key"></i> Mật khẩu (bỏ trống nếu không đổi)</label>
                    <input asp-for="MatKhau" type="password" class="form-control" placeholder="••••••••" />
                    <span asp-validation-for="MatKhau" class="text-danger small"></span>
                </div>

                <!-- SĐT -->
                <div class="col-md-6">
                    <label asp-for="SDT" class="form-label fw-bold"><i class="bi bi-telephone"></i> Số điện thoại</label>
                    <input asp-for="SDT" class="form-control" />
                    <span asp-validation-for="SDT" class="text-danger small"></span>
                </div>

                <!-- Địa chỉ -->
                <div class="col-12">
                    <label asp-for="DiaChi" class="form-label fw-bold"><i class="bi bi-geo-alt"></i> Địa chỉ</label>
                    <input asp-for="DiaChi" class="form-control" />
                    <span asp-validation-for="DiaChi" class="text-danger small"></span>
                </div>

                <!-- Loại người dùng -->
                <div class="col-md-6">
                    <label asp-for="LoaiNguoiDung" class="form-label fw-bold"><i class="bi bi-person-badge"></i> Loại người dùng</label>
                    <select asp-for="LoaiNguoiDung" class="form-select">
                        <option value="Admin" selected="@(Model.LoaiNguoiDung == "Admin")">Admin</option>
                        <option value="User" selected="@(Model.LoaiNguoiDung == "User")">User</option>
                    </select>
                    <span asp-validation-for="LoaiNguoiDung" class="text-danger small"></span>
                </div>

                <!-- Trạng thái -->
                <div class="col-md-6">
                    <label asp-for="TrangThai" class="form-label fw-bold"><i class="bi bi-toggle-on"></i> Trạng thái</label>
                    <select asp-for="TrangThai" class="form-select">
                        <option value="Hoạt động" selected="@(Model.TrangThai == "Hoạt động")">Hoạt động</option>
                        <option value="Khóa" selected="@(Model.TrangThai == "Khóa")">Khóa</option>
                    </select>
                    <span asp-validation-for="TrangThai" class="text-danger small"></span>
                </div>

                <!-- Ảnh đại diện -->
                <div class="col-12">
                    <label asp-for="HinhAnhFile" class="form-label fw-bold"><i class="bi bi-image"></i> Ảnh đại diện</label>
                    <input asp-for="HinhAnhFile" type="file" class="form-control" id="imageInput" accept="image/*" />

                    <div class="mt-3 text-center">
                        @if (!string.IsNullOrEmpty(Model.HinhAnh))
                        {
                            <img id="previewImage" src="~/images/nguoidung/@Model.HinhAnh"
                                 class="rounded-circle shadow border"
                                 style="width:150px; height:150px; object-fit:cover;" />
                        }
                        else
                        {
                            <img id="previewImage" src="https://via.placeholder.com/150"
                                 class="rounded-circle shadow border"
                                 style="width:150px; height:150px; object-fit:cover;" />
                        }
                    </div>
                </div>

                <!-- Buttons -->
                <div class="col-12 text-end mt-4">
                    <button type="submit" class="btn btn-success px-4">
                        <i class="bi bi-save"></i> Cập nhật
                    </button>
                    <a asp-action="Index" class="btn btn-secondary px-4">
                        <i class="bi bi-x-circle"></i> Hủy
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<!-- Script xem trước ảnh -->
@section Scripts {
    <script>
        document.getElementById("imageInput")?.addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (x) {
                    document.getElementById("previewImage").src = x.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
