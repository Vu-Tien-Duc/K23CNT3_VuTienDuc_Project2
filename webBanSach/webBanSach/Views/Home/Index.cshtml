@model webBanSach.ViewModels.HomeViewModel
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Trang Chủ";
    var userName = HttpContextAccessor.HttpContext?.Session.GetString("UserName");
}

<div class="container mt-5">

    <!-- PHẦN CHÀO MỪNG -->
    <div class="text-center mb-5 p-4 rounded" style="background: linear-gradient(to right, #6a11cb, #2575fc); color: white;">
        <h1 class="display-4 fw-bold">📚 Welcome to Cửa hàng sách!</h1>
        <p class="lead">Khám phá kho tàng tri thức với hàng ngàn đầu sách hấp dẫn.</p>
        <div class="mt-4">
            <a href="/Sach/Index" class="btn btn-light btn-lg me-2">
                <i class="bi bi-book"></i> Xem sách
            </a>
            <a href="/Home/About" class="btn btn-outline-light btn-lg">
                <i class="bi bi-info-circle"></i> Giới thiệu
            </a>
        </div>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success text-center">
            @TempData["Message"]
        </div>
    }

    <!-- BANNER -->
    <div class="card shadow-lg border-0 rounded-3 mb-5 overflow-hidden">
        <div id="bookCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="https://img.freepik.com/free-photo/stack-books_144627-20260.jpg"
                         class="d-block w-100" style="height: 350px; object-fit: cover;" />
                </div>
                <div class="carousel-item">
                    <img src="https://img.freepik.com/free-photo/books-on-wooden-table_144627-20123.jpg"
                         class="d-block w-100" style="height: 350px; object-fit: cover;" />
                </div>
                <div class="carousel-item">
                    <img src="https://img.freepik.com/free-photo/open-book-with-glasses_144627-20232.jpg"
                         class="d-block w-100" style="height: 350px; object-fit: cover;" />
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#bookCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#bookCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    </div>

    <style>
        /* Card sách */
        .book-card {
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

            .book-card:hover {
                transform: translateY(-8px);
                box-shadow: 0 12px 25px rgba(0,0,0,0.2);
            }

            .book-card img {
                height: 220px;
                object-fit: cover;
            }

        .btn-buy {
            background-color: #28a745;
            color: white;
            transition: background-color 0.2s;
        }

            .btn-buy:hover {
                background-color: #218838;
                color: white;
            }

        .btn-detail {
            border-color: #0d6efd;
            color: #0d6efd;
            transition: all 0.2s;
        }

            .btn-detail:hover {
                background-color: #0d6efd;
                color: white;
            }
    </style>

    <!-- SÁCH NỔI BẬT -->
    <section class="mb-5">
        <h3 class="mb-4 text-warning">🔥 Sách nổi bật</h3>
        <div class="row g-4">
            @if (Model.SachNoiBat != null && Model.SachNoiBat.Any())
            {
                foreach (var sach in Model.SachNoiBat)
                {
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card book-card shadow-sm border-0 h-100">
                            <img src="~/images/sach/@sach.HinhAnh" class="card-img-top" />
                            <div class="card-body text-center d-flex flex-column">
                                <h6 class="fw-bold">@sach.TenSach</h6>
                                <p class="text-danger fw-bold">@sach.GiaBan.ToString("N0") đ</p>
                                <div class="d-grid gap-2 mt-auto">
                                    <a href="/Sach/Details/@sach.MaSach" class="btn btn-detail btn-sm">Xem chi tiết</a>

                                    @if (!string.IsNullOrEmpty(userName))
                                    {
                                        @if (sach.SoLuong > 0)
                                        {
                                            <form asp-controller="Cart" asp-action="Add" method="post" class="d-inline">
                                                <input type="hidden" name="maSach" value="@sach.MaSach" />
                                                <button type="submit" class="btn btn-buy btn-sm w-100">Thêm vào giỏ</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <button class="btn btn-secondary btn-sm w-100" disabled>Hết hàng</button>
                                        }
                                    }
                                    else
                                    {
                                        <a href="/Account/Login" class="btn btn-buy btn-sm w-100">Thêm vào giỏ</a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <p class="text-muted">👉 Hiện chưa có sách nổi bật.</p>
            }
        </div>
    </section>

    <!-- SÁCH BÁN CHẠY -->
    <section class="mb-5">
        <h3 class="mb-4 text-success">⭐ Sách bán chạy</h3>
        <div class="row g-4">
            @if (Model.SachBanChay != null && Model.SachBanChay.Any())
            {
                foreach (var sach in Model.SachBanChay)
                {
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card book-card shadow-sm border-0 h-100">
                            <img src="~/images/sach/@sach.HinhAnh" class="card-img-top" />
                            <div class="card-body text-center d-flex flex-column">
                                <h6 class="fw-bold">@sach.TenSach</h6>
                                <p class="text-danger fw-bold">@sach.GiaBan.ToString("N0") đ</p>
                                <span class="badge bg-success mb-2">
                                    Đã bán: @(ViewBag.DaBan is Dictionary<int, int> dict && dict.ContainsKey(sach.MaSach) ? dict[sach.MaSach] : 0)
                                </span>
                                <div class="d-grid gap-2 mt-auto">
                                    <a href="/Sach/Details/@sach.MaSach" class="btn btn-detail btn-sm">Xem chi tiết</a>

                                    @if (!string.IsNullOrEmpty(userName))
                                    {
                                        @if (sach.SoLuong > 0)
                                        {
                                            <form asp-controller="Cart" asp-action="Add" method="post" class="d-inline">
                                                <input type="hidden" name="maSach" value="@sach.MaSach" />
                                                <button type="submit" class="btn btn-buy btn-sm w-100">Thêm vào giỏ</button>
                                            </form>
                                        }
                                        else
                                        {
                                            <button class="btn btn-secondary btn-sm w-100" disabled>Hết hàng</button>
                                        }
                                    }
                                    else
                                    {
                                        <a href="/Account/Login" class="btn btn-buy btn-sm w-100">Thêm vào giỏ</a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <p class="text-muted">👉 Hiện chưa có sách bán chạy.</p>
            }
        </div>
    </section>

</div>
